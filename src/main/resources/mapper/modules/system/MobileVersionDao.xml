<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kylin.modules.system.dao.MobileVersionDao">

    <insert id="save" parameterType="com.kylin.modules.system.entity.MobileVersion" keyProperty="versionId">
        insert into MOBILE_VERSION
        (
        DEPT_NUM,
        VERSION_NO,
        REMARK,
        FILE_PATH
        )
        values
        (
        #{deptNum},
        #{versionNo},
        #{remark},
        #{filePath}
        )
    </insert>

    <select id="queryObject" resultType="com.kylin.modules.system.entity.MobileVersion">
        select * from MOBILE_VERSION where VERSION_ID = #{versionId}
    </select>

    <!-- 查询数据总数 -->
    <select id="queryTotal" resultType="int">
        select count(*) from MOBILE_VERSION
    </select>

    <!-- 查询集团公司 -->
    <select id="queryListParentID" resultType="com.kylin.modules.system.entity.MobileVersion">
        select t.name,t.dept_num as deptNum from dbo.sys_dept t where parent_id = #{parentId}
    </select>

    <!-- 查询更新说明 -->
    <select id="queryReamrkByVersionId" parameterType="HashMap" resultType="com.kylin.modules.system.entity.MobileVersion">
        select m.REMARK from dbo.MOBILE_VERSION m where m.VERSION_ID = #{versionId}
    </select>

    <!--<查询移动端数据>-->
    <select id="queryList" resultType="com.kylin.modules.system.entity.MobileVersion">
        select
        <choose>
            <when test="limit != null ">
                top ${limit} temp.*,(SELECT t.name from sys_dept t WHERE t.dept_num = temp.DEPT_NUM ) as deptNum
                from (
                SELECT ROW_NUMBER() OVER (ORDER BY VERSION_ID) AS RowNumber,* FROM MOBILE_VERSION
                ) AS  temp
            </when>
            <otherwise>
                * from MOBILE_VERSION c
            </otherwise>
        </choose>
        <if test="page != null and limit != null">
            WHERE RowNumber > ${limit}*(${page}-1)
        </if>

        <if test="versionNo != null and versionNo.trim() != ''">
            and VERSION_NO = #{versionNo}
        </if>

        <if test="deptNum != null and deptNum.trim() != ''">
            and dept_num = #{deptNum}
        </if>

    </select>

    <update id="update" parameterType="com.kylin.modules.system.entity.MobileVersion">
        update MOBILE_VERSION
        <set>
            <if test="deptNum != null">DEPT_NUM = #{deptNum}, </if>
            <if test="versionNo != null">VERSION_NO = #{versionNo}, </if>
            <if test="remark != null">REMARK = #{remark}, </if>
            <if test="filePath != null">FILE_PATH = #{filePath} </if>
        </set>
        where VERSION_ID  = #{versionId}
    </update>

    <delete id="deleteBatch"  parameterType="String">
        delete from MOBILE_VERSION where VERSION_ID in
        <foreach item="versionId" collection="array" open="(" separator="," close=")">
            #{versionId}
        </foreach>
    </delete>

</mapper>